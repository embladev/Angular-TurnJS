angular.module("angularTurn",[]),function(){"use strict";var e=function(e,t){function a(e,t,a,n){t.bind("turned",function(t,a,n){e.ctrl.currentPage=a,e.ctrl.isPageLoadEnabled&&a>=e.ctrl.noOfActualPages-4&&e.ctrl.turnPageForward()}),e.ctrl.loadNextPages().then(function(a){document.getElementById("frontView").remove(),t.turn({width:e.ctrl.width,height:e.ctrl.height,autoCenter:e.ctrl.autoCenter});for(var n,r=0;r<4;r++)n=e.ctrl.virtualPagesBuffer.shift(),t.turn("addPage",n,++e.ctrl.noOfActualPages);e.ctrl.isPageLoadEnabled=!0,e.ctrl.virtualPagesBuffer.length<6&&e.ctrl.loadNextPages()},function(e){})}var n=function(e,t,a){var n=this;n.isFirstDir=!0,n.isPageLoadEnabled=!1,n.pageDirCtrls=[],n.currentPage=1,n.noOfActualPages=-1,n.virtualPagesBuffer=[],n.height=a.ngbHeight,n.width=a.ngbWidth,n.autoCenter=a.ngbAutocenter,n.initializeFrontView=function(){t.parent().append('<div id="frontView"><h1>Loading book...</h1></div>')},n.register=function(e){n.isFirstDir&&(n.isFirstDir=!1,e.hasToken=!0),n.pageDirCtrls.push(e)},n.turnPageForward=function(){if(n.virtualPagesBuffer.length<=2)n.loadNextPages().then(function(e){var a=n.virtualPagesBuffer.shift();t.turn("addPage",a,++n.noOfActualPages),a=n.virtualPagesBuffer.shift(),t.turn("addPage",a,++n.noOfActualPages),n.virtualPagesBuffer.length<6&&n.loadNextPages()},function(e){});else{var e=n.virtualPagesBuffer.shift();t.turn("addPage",e,++n.noOfActualPages),e=n.virtualPagesBuffer.shift(),t.turn("addPage",e,++n.noOfActualPages),n.virtualPagesBuffer.length<6&&n.loadNextPages()}},n.loadNextPages=function(){return new Promise(function(e,t){n.pageDirCtrls.forEach(function(a){1==a.hasToken&&(null==a.pageTemplate?a.loadTemplate().then(function(t){a.hasMoreContent?(n.virtualPagesBuffer=n.virtualPagesBuffer.concat(a.makeVirtualPages(6)),n.virtualPagesBuffer[0].length>=6&&e("Success!")):(a.hasToken=!1,n.pageDirCtrls[a.id+1].hasToken=!0)},function(e){t("Failure!")}):a.hasMoreContent?(n.virtualPagesBuffer=n.virtualPagesBuffer.concat(a.makeVirtualPages(6)),n.virtualPagesBuffer[0].length>=6&&e("Success!")):(a.hasToken=!1,n.pageDirCtrls[a.id+1].hasToken=!0))})})},n.initializeFrontView()};return{restrict:"E",scope:{},controller:n,controllerAs:"ctrl",link:a,replace:!0,transclude:!0,template:"<div ng-transclude></div>"}};angular.module("angularTurn").directive("book",e)}(),function(){"use strict";var e=function(e){function t(e,t,a,n,l,o){var i=this;i.id=r,i.pageTemplatePath=a.ngbTemplate,i.pageTemplate=null,i.pageTemplateElement=null,i.brokenPagesBuffer=[],i.overflowHtmlContent="",i.hasMoreContent=!0,i.hasToken=!1,i.loadTemplate=function(){return new Promise(function(e,t){o(function(){n.get(i.pageTemplatePath).then(function(t){i.pageTemplate="<div>"+t.data+"</div>",i.pageTemplateElement=angular.element(i.pageTemplate),e("Success!")},function(){t("Failure!")})},3e3)})},i.makeVirtualPages=function(e){var t=[],a={},n={};n.overflowHtmlContent="";for(var r="";t.length<e;){var l=10;r=i.getHtml(l),a=i.breakPages(r+n.overflowHtmlContent),t=t.concat(a.brokenPages),n.overflowHtmlContent=a.overflowHtmlContent}return i.overflowHtmlContent=a.overflowHtmlContent,t},i.getHtml=function(t){var a;return e.$apply(function(){a=l(i.pageTemplateElement)(e)}),a.html()},i.breakPages=function(e){return{brokenPages:[e,e],overflowHtmlContent:""}}}function a(t,a,l,o){r++,e(l.ngbController,{$scope:t}),n=o[0],n.register(o[1])}var n,r=0;return{restrict:"E",require:["^book","page"],link:a,scope:{},controller:t,replace:!0,transclude:!0,template:"<div ng-transclude></div>"}};angular.module("angularTurn").directive("page",e)}();